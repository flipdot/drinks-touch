services:
  postgres:
    image: "postgres:17.8@sha256:1eada89ec2521ae0f61125f6bdaf83bbbf88a43fecda48d112a83bb92df75c36"
    environment:
      POSTGRES_USER: drinks
      POSTGRES_PASSWORD: drinks
      POSTGRES_DB: drinks
    ports:
      - 5432:5432


  keycloak:
    image: "quay.io/keycloak/keycloak:26.5@sha256:5a236ae4dd8ece77490115bace15a11a4d15e9cbcf58a490b95a7da2cd71d32a"
    environment:
        KC_BOOTSTRAP_ADMIN_USERNAME: admin
        KC_BOOTSTRAP_ADMIN_PASSWORD: admin
    ports:
        - "8080:8080"
    command: "start-dev --proxy-headers xforwarded --import-realm"
    volumes:
      # Old data isn't compatible since we upgrade from 25.0.7 to 26.2?
      # Commenting out here for simplicity. Feel free to fix
      # - keycloak:/opt/keycloak/data
      # To update the realm, stop keycloak and run:
      # docker compose -f compose.dev.yaml run -it keycloak export --file /opt/keycloak/data/import/flipdot.json --realm flipdot
      # Attention: The file it exports isn't importable.
      # Explanation at https://github.com/flipdot/drinks-touch/pull/213#discussion_r1769129578
      - ./keycloak/realms/:/opt/keycloak/data/import


  mailpit:
    image: axllent/mailpit@sha256:7c38788069433ba9d2d9131abac8d17da0fb18f09b689207ec7a773dcb8d6eee
    restart: always
    environment:
      MP_SMTP_AUTH_ACCEPT_ANY: true
      MP_SMTP_AUTH_ALLOW_INSECURE: true
    ports:
      - 8025:8025
      - 1025:1025

volumes:
  keycloak:
